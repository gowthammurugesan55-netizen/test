<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OMISHA CAFE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .category-pill { scroll-margin-top: 100px; }
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 10px; }
        
        /* Veg/Non-Veg Indicators */
        .veg-box { width: 16px; height: 16px; border: 2px solid #10b981; border-radius: 2px; display: inline-flex; align-items: center; justify-content: center; margin-right: 6px; }
        .veg-dot { width: 6px; height: 6px; background: #10b981; border-radius: 50%; }
        .nonveg-box { width: 16px; height: 16px; border: 2px solid #ef4444; border-radius: 2px; display: inline-flex; align-items: center; justify-content: center; margin-right: 6px; }
        .nonveg-dot { width: 6px; height: 6px; background: #ef4444; border-radius: 50%; }
        
        /* Filter Button Styles */
        .filter-btn { padding: 8px 16px; border-radius: 20px; border: 2px solid #d1d5db; background: white; cursor: pointer; font-weight: 600; font-size: 12px; transition: all 0.3s; margin: 0 4px; }
        .filter-btn.active { background: #f97316; color: white; border-color: #f97316; }
        
        /* Error styling */
        .input-error { border-color: #ef4444 !important; background-color: #fef2f2 !important; }
        .error-text { color: #ef4444; font-size: 12px; margin-top: 4px; }
        
        /* Toast Notification */
        .toast { position: fixed; bottom: 100px; left: 20px; right: 20px; padding: 12px 16px; border-radius: 10px; color: white; font-weight: 600; animation: slideUp 0.3s ease-out; z-index: 100; }
        .toast.success { background: #10b981; }
        .toast.error { background: #ef4444; }
        @keyframes slideUp { from { transform: translateY(100px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        /* Favorites Star */
        .fav-star { cursor: pointer; font-size: 18px; transition: all 0.2s; }
        .fav-star.active { color: #f97316; }
        
        /* History Modal */
        .history-item { background: white; padding: 12px 16px; border-radius: 10px; border-left: 4px solid #f97316; margin-bottom: 8px; }
        .history-item-time { font-size: 12px; color: #999; }
        .history-item-amount { font-weight: bold; color: #f97316; }
        .quick-add-btn { padding: 6px 12px; background: #f97316; color: white; border: none; border-radius: 6px; font-size: 12px; cursor: pointer; }
    </style>
</head>
<body class="bg-cream pb-32 text-brown-900">

    <header class="bg-gradient-to-r from-green-700 via-green-500 to-green-400 text-brown-900 p-4 md:p-6 shadow-xl sticky top-0 z-50 rounded-b-2xl md:rounded-b-3xl">
        <div class="flex flex-col items-center">
            <h1 class="text-2xl md:text-3xl font-extrabold tracking-tight drop-shadow text-brown-900 text-center mb-2">OMISHA CAFE</h1>
            <div class="flex w-full justify-between items-center mb-2">
                <p id="dynamic-greeting" class="text-xs md:text-sm font-semibold text-left">Welcome</p>
                <span id="room-display" class="text-xs md:text-sm bg-green-200 px-3 py-1 rounded-full border border-green-700 font-semibold shadow text-brown-900 text-right">Room: ...</span>
            </div>
        </div>
        
        <!-- Search Bar -->
        <div class="relative mb-1 md:mb-4">
            <i class="fa fa-search absolute left-4 top-1/2 -translate-y-1/2 text-orange-400 text-lg"></i>
            <input type="text" id="search-input" oninput="filterMenu()" placeholder="Search coffee, snacks..." 
                class="w-full p-3 pl-12 rounded-2xl bg-white/90 text-gray-800 text-base md:text-lg font-medium shadow focus:outline-none focus:ring-2 focus:ring-orange-500 transition-all duration-200 placeholder placeholder-orange-300">
        </div>
        <!-- Filter Buttons -->
        <div class="flex justify-center gap-2 mb-3 md:mb-4">
            <button onclick="toggleDietaryFilter('all')" id="filter-all" class="filter-btn active text-orange-900 bg-orange-100 border-orange-300 shadow-sm hover:bg-orange-200 transition-all duration-200 scale-100 hover:scale-105">All</button>
            <button onclick="toggleDietaryFilter('veg')" id="filter-veg" class="filter-btn bg-green-50 border-green-300 text-green-700 shadow-sm hover:bg-green-100 transition-all duration-200 scale-100 hover:scale-105"><i class="fa fa-leaf"></i> Veg</button>
            <button onclick="toggleDietaryFilter('nonveg')" id="filter-nonveg" class="filter-btn bg-red-50 border-red-300 text-red-700 shadow-sm hover:bg-red-100 transition-all duration-200 scale-100 hover:scale-105">üçó Non-Veg</button>
        </div>

        <div id="status-notice" class="mt-2 text-[10px] text-center py-1 rounded-md font-bold uppercase tracking-widest bg-orange-800/50 text-orange-200">
    Service Hours: <span id="hours-display">Loading...</span>
</div>

    </header>

    <div id="special-banner-container" class="px-4 mt-4 overflow-hidden whitespace-nowrap">
    <div id="banner-slider" class="flexflex-transform duration-500 ease-in-out">
        </div>
    </div>
<div id="upsell-progress-container" class="px-4 mt-4">
    <div class="bg-white p-3 rounded-2xl shadow border border-orange-100">
        <div class="flex justify-between text-xs font-bold mb-1">
            <span id="upsell-msg" class="text-orange-900">Add more for a surprise!</span>
            <span id="upsell-percent">0%</span>
        </div>
        <div class="w-full bg-gray-100 h-2 rounded-full overflow-hidden">
            <div id="upsell-bar" class="bg-gradient-to-r from-orange-400 via-orange-500 to-orange-600 h-full transition-all duration-500" style="width: 0%"></div>
        </div>
    </div>
</div>

    <main class="p-4 max-w-md mx-auto" id="menu-container">
        <div class="text-center py-20 text-gray-400">Loading Menu...</div>
    </main>

    <div id="nav-btn" onclick="toggleNav()" class="fixed bottom-24 right-4 bg-green-600 text-white w-16 h-16 rounded-full shadow-2xl flex items-center justify-center border-4 border-green-300 z-[55] cursor-pointer transition-transform duration-200 hover:scale-110">
    <div class="relative">
        <i class="fa fa-utensils text-3xl"></i>
        <!-- <span id="cart-badge" class="absolute -top-2 -right-2 bg-gold text-brown-900 text-xs font-bold px-2 py-1 rounded-full shadow-lg">0</span> -->
    </div>
</div>

    <div id="nav-menu" class="fixed inset-0 bg-black/40 z-[60] hidden" onclick="toggleNav()">
        <div class="absolute bottom-40 right-4 bg-white rounded-2xl p-0 shadow-2xl min-w-[200px] max-h-[60vh] overflow-y-auto" onclick="event.stopPropagation()">
            <h3 class="text-xs font-bold text-gray-400 mb-3 uppercase tracking-widest p-2">Categories</h3>
            <div id="category-list" class="space-y-3 p-2"></div>
            <hr class="my-4">
            <button onclick="toggleTrackOrder(); toggleNav();" class="w-full text-left py-2 text-sm font-medium text-gray-600 hover:text-blue-700 flex items-center gap-1 p-2">
    <i class="fa fa-search"></i> Track Order
</button>
            <button onclick="toggleHistory(); toggleNav();" class="w-full text-left py-2 text-sm font-medium text-gray-600 hover:text-orange-700 flex items-center gap-2 p-2">
                <i class="fa fa-history"></i> View Order History
            </button>
            <button onclick="clearCartStorage(); location.reload();" class="w-full text-left py-2 text-sm font-medium text-gray-600 hover:text-red-700 flex items-center gap-2 p-2">
                <i class="fa fa-trash"></i> Clear Cart
            </button>
        </div>
    </div>

    <a id="call-link" href="tel:+1234567890" class="fixed bottom-24 left-4 bg-green-600 text-white w-12 h-12 rounded-full shadow-2xl flex items-center justify-center z-[55] cursor-pointer">
    <i class="fa fa-phone"></i>
</a>

    <!-- History Modal -->
    <div id="history-modal" class="fixed inset-0 bg-black/60 z-[70] hidden flex items-end">
        <div class="bg-white w-full rounded-t-[2.5rem] p-8 max-h-[85vh] overflow-y-auto shadow-2xl">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold"><i class="fa fa-history mr-2 text-orange-900"></i>Order History</h2>
                <button onclick="closeHistory()" class="text-gray-300 text-3xl">&times;</button>
            </div>
            <div id="history-list" class="space-y-3">
                <p class="text-center text-gray-400 py-8">No order history yet</p>
            </div>
        </div>
    </div>

    <!-- Favorites Modal -->
    <div id="favorites-modal" class="fixed inset-0 bg-black/60 z-[70] hidden flex items-end">
        <div class="bg-white w-full rounded-t-[2.5rem] p-8 max-h-[85vh] overflow-y-auto shadow-2xl">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold"><i class="fa fa-heart mr-2 text-red-500"></i>Favorites</h2>
                <button onclick="closeFavorites()" class="text-gray-300 text-3xl">&times;</button>
            </div>
            <div id="favorites-list" class="space-y-3">
                <p class="text-center text-gray-400 py-8">No favorites yet. Mark items with ‚ù§Ô∏è</p>
            </div>
        </div>
    </div>

    <!-- Track Order Modal -->
    <div id="track-order-modal" class="fixed inset-0 bg-black/60 z-[80] hidden flex items-end">
        <div class="bg-white w-full rounded-t-[2.5rem] p-8 max-h-[85vh] overflow-y-auto shadow-2xl">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold"><i class="fa fa-search mr-2 text-blue-900"></i>Track Your Order</h2>
                <button onclick="closeTrackOrder()" class="text-gray-300 text-3xl">&times;</button>
            </div>
            <div class="mb-4">
                <input id="track-order-id" type="text" placeholder="Enter Order ID (e.g. ORD-123456)" class="w-full p-4 bg-gray-50 border-none rounded-2xl focus:ring-2 focus:ring-blue-500 text-sm">
                <button onclick="trackOrderStatus()" class="w-full mt-3 bg-blue-600 text-white py-3 rounded-2xl font-bold text-lg shadow-xl">Check Status</button>
            </div>
            <div id="track-order-result" class="mt-4"></div>
        </div>
    </div>

    <!-- Order Confirmation Modal -->
    <div id="order-confirmation-modal" class="fixed inset-0 bg-black/60 z-[80] hidden flex items-center justify-center">
        <div class="bg-white rounded-2xl p-6 max-w-sm w-11/12 shadow-2xl text-center animate-fadeIn">
            <div class="mb-4">
                <i class="fa fa-check-circle text-green-500 text-5xl mb-3"></i>
                <h2 class="text-2xl font-bold text-gray-800 mb-2">Order Confirmed!</h2>
                <p class="text-gray-600 text-sm mb-4">Your delicious meal is being prepared</p>
                <div class="bg-orange-50 p-4 rounded-xl mb-4">
                    <p class="text-xs text-gray-500 uppercase font-bold">Order ID</p>
                    <p id="order-id-display" class="text-xl font-black text-orange-900">ORD-000000</p>
                </div>
                <div class="space-y-2 text-left mb-4">
                    <p class="text-sm"><span class="font-bold">Room:</span> <span id="confirm-room" class="text-orange-900">---</span></p>
                    <p class="text-sm"><span class="font-bold">Name:</span> <span id="confirm-name" class="text-gray-700">---</span></p>
                    <p class="text-sm"><span class="font-bold">Items:</span> <span id="confirm-items" class="text-gray-700">---</span></p>
                    <p class="text-sm"><span class="font-bold">Total:</span> <span id="confirm-total" class="text-orange-900 font-bold">‚Çπ0.00</span></p>
                    <p class="text-sm"><span class="font-bold">Est. Time:</span> <span class="text-green-600" data-est-time>20-25 mins</span></p>
                </div>
            </div>
            <button onclick="closeConfirmationAndRefresh()" class="w-full bg-green-600 text-white py-3 rounded-xl font-bold">Back to Menu</button>
        </div>
    </div>

    <div id="bottom-bar" class="fixed bottom-0 left-0 right-0 bg-white border-t p-4 flex justify-between items-center hidden shadow-[0_-10px_20px_rgba(0,0,0,0.05)] z-50">
        <div onclick="toggleCart()" class="cursor-pointer">
            <p id="cart-count-bottom" class="text-orange-900 font-bold text-sm">0 Items</p>
            <p id="cart-total-bottom" class="text-xl font-black text-gray-900">$0.00</p>
        </div>
        <button onclick="toggleCart()" class="bg-orange-900 text-white px-8 py-3 rounded-2xl font-bold shadow-lg shadow-orange-900/20">View Cart</button>
    </div>

<div id="cart-modal" class="fixed inset-0 bg-black/60 z-[70] hidden flex items-end md:items-center">
        <div class="bg-white w-full md:w-[500px] rounded-t-[2.5rem] md:rounded-2xl p-4 md:p-8 max-h-[90vh] overflow-y-auto shadow-2xl relative flex flex-col">
            <!-- Close Button -->
            <button onclick="toggleCart()" class="absolute top-4 right-4 bg-gray-100 hover:bg-red-200 text-gray-700 hover:text-red-700 rounded-full w-10 h-10 flex items-center justify-center text-2xl shadow-md z-10" aria-label="Close cart">&times;</button>
            <!-- Cart Summary -->
            <div class="flex flex-col md:flex-row items-center mb-4">
                <div class="text-lg font-bold text-green-700">Your Order</div>
                <div class="flex gap-2 mt-2 md:mt-0">
                    <span id="cart-count" class="bg-green-100 text-green-700 px-3 py-1 rounded-full font-semibold text-sm">0 Items</span>
                    <span id="cart-total" class="bg-gold text-brown-900 px-3 py-1 rounded-full font-bold text-sm">‚Çπ0.00</span>
                </div>
            </div>
            <!-- Order Items -->
            <div id="cart-items" class="space-y-4 mb-8">
                <!-- Each item: icon, name, price, quantity controls, remove button -->
                <!-- Example item structure:
                <div class="flex items-center justify-between bg-cream rounded-xl p-3 shadow-sm">
                    <div class="flex items-center gap-3">
                        <img src="/path/to/icon.png" alt="Item" class="w-8 h-8 rounded-full bg-green-100">
                        <div>
                            <div class="font-semibold text-brown-900">Chapathi(2pcs) with Curry</div>
                            <div class="text-green-700 font-bold">‚Çπ90.00</div>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <button class="bg-green-200 text-green-700 rounded-full w-8 h-8 flex items-center justify-center font-bold text-lg shadow hover:bg-green-300 transition-all duration-200">-</button>
                        <span class="font-bold text-brown-900 mx-2">2</span>
                        <button class="bg-green-500 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold text-lg shadow hover:bg-green-600 transition-all duration-200">+</button>
                        <button class="bg-red-100 text-red-700 rounded-full w-8 h-8 flex items-center justify-center text-xl ml-2" aria-label="Remove item">&times;</button>
                    </div>
                </div>
                -->
            </div>
            <!-- Treat Yourself Section -->
            <div id="treat-yourself" class="mb-8 hidden">
                <p class="text-xs font-bold text-gray-400 mb-3 uppercase tracking-widest">Treat Yourself</p>
                <div id="upsell-list" class="flex gap-3 overflow-x-auto no-scrollbar pb-2"></div>
            </div>
            <!-- Delivery Details -->
            <div class="space-y-4 border-t pt-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <input type="text" id="cust-name" placeholder="Full Name" class="p-4 bg-gray-50 border-none rounded-2xl focus:ring-2 focus:ring-green-500 text-sm w-full" oninput="validateName()">
                        <p id="name-error" class="error-text hidden"></p>
                    </div>
                    <div>
                        <input type="tel" id="cust-phone" placeholder="Mobile Number" class="p-4 bg-gray-50 border-none rounded-2xl focus:ring-2 focus:ring-green-500 text-sm w-full" oninput="validatePhone()">
                        <p id="phone-error" class="error-text hidden"></p>
                    </div>
                </div>
                <div class="bg-gray-50 p-4 rounded-2xl">
                    <p class="text-xs font-bold text-gray-400 mb-2 uppercase">Delivery Time</p>
                    <select id="delivery-schedule" class="w-full bg-transparent border-none focus:ring-0 text-sm font-semibold">
                        <option value="Now">Deliver Now (ASAP)</option>
                        <option value="Morning (08:00 - 09:00)">Breakfast (08:00 - 09:00 AM)</option>
                        <option value="Morning (09:00 - 10:00)">Breakfast (09:00 - 10:00 AM)</option>
                        <option value="Other">Specific time (Add in notes)</option>
                    </select>
                </div>
                <textarea id="special-notes" placeholder="Any special requests? (e.g. No onions, extra sugar, less ice...)" class="w-full p-4 bg-gray-50 border rounded-2xl focus:ring-2 focus:ring-green-500 text-sm h-24"></textarea>
                <div class="bg-gray-50 p-4 rounded-2xl">
                    <p class="text-xs font-bold text-gray-400 mb-2 uppercase">Payment Method</p>
                    <div class="flex gap-4">
                        <label class="flex items-center gap-2 text-sm">
                            <input type="radio" name="payment" value="Room Charge" checked class="text-green-700"> Room Charge
                        </label>
                        <label class="flex items-center gap-2 text-sm">
                            <input type="radio" name="payment" value="Cash/UPI" class="text-green-700"> Cash/UPI
                        </label>
                    </div>
                </div>
            </div>
            <!-- Sticky Place Order Button -->
            <div class="sticky bottom-0 left-0 right-0 bg-white pt-4 pb-2">
                <button onclick="sendOrder()" id="place-order-btn" class="w-full bg-green-600 text-white py-4 rounded-2xl font-bold text-lg shadow-lg">Place Order</button>
            </div>
        </div>
    </div>

<script>
// Example quantity control logic for cart items
function updateCartItemQty(itemId, delta) {
    // Find item in cart, update quantity, re-render cart
}
function removeCartItem(itemId) {
    // Remove item from cart, re-render cart
}
// Make sure cart modal is vertically stacked and sticky button works on mobile
</script>
    <!-- Loading Spinner Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-55 hidden" aria-live="polite" aria-label="Loading">
        <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-orange-500 border-solid"></div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-6 right-6 bg-green-600 text-white px-4 py-2 rounded shadow-lg opacity-0 pointer-events-none transition-all duration-500 z-50" role="status" aria-live="polite"></div>

    <!-- Dark Mode Toggle Button -->
    <!-- <button id="darkModeToggle" class="fixed top-4 right-4 z-[100] w-12 h-12 flex items-center justify-center bg-white dark:bg-gray-800 text-orange-900 dark:text-orange-200 rounded-full shadow-lg border border-orange-100 dark:border-gray-700 transition-all duration-200 hover:bg-orange-100 dark:hover:bg-gray-700 hover:scale-110 focus:outline-none focus:ring-2 focus:ring-orange-500 dark:focus:ring-orange-300" aria-label="Toggle dark mode" style="font-size:1.5rem;">
                    <span class="sr-only">Toggle dark mode</span>
                    <i class="fas fa-moon group-hover:scale-125 transition-transform duration-200"></i>
                    <span class="absolute left-1/2 -bottom-8 -translate-x-1/2 bg-gray-900 text-white text-xs rounded px-2 py-1 opacity-0 group-hover:opacity-100 pointer-events-none transition-opacity duration-200">Dark Mode</span>
                </ button> -->

    <script>
        const hr = new Date().getHours();
const greeting = hr < 12 ? "Good Morning ‚òï" : hr < 17 ? "Good Afternoon ü•ó" : "Good Evening üçΩÔ∏è";
document.getElementById('dynamic-greeting').innerText = greeting;

        let menu = {};
        let banner = {};
            let cart = {};
        let currentDietaryFilter = 'all';
        let favorites = JSON.parse(localStorage.getItem('favorites') || '{}');
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbx_YgOYiEthHx5Y4FVDbK5C_xEXe0mum_stCQ-T143tfhaLUwjJJ9U2gOdB3OpLsXva/exec";
        const ORDER_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyyiVCkR1NNS6IM6zVHFjbs5g1vc4iQGsahfPJgoMknMDQsdFiE2FLQZuotVeDm7lk-KQ/exec";
        const params = new URLSearchParams(window.location.search);
        const roomNumber = params.get('room') || "Lobby";
        document.getElementById('room-display').innerText = "Room: " + roomNumber;

        // ========== TOAST NOTIFICATIONS (Animated, Accessible) ==========
        let toastTimeout;
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `fixed bottom-6 right-6 px-4 py-2 rounded shadow-lg opacity-0 pointer-events-none transition-all duration-500 z-50 bg-${type === 'error' ? 'red' : 'green'}-600 text-white`;
            setTimeout(() => {
                toast.classList.remove('opacity-0', 'pointer-events-none');
                toast.classList.add('opacity-100');
            }, 10);
            clearTimeout(toastTimeout);
            toastTimeout = setTimeout(() => {
                toast.classList.remove('opacity-100');
                toast.classList.add('opacity-0', 'pointer-events-none');
            }, 3000);
        }

        // ========== LOADING SPINNER OVERLAY ==========
        function showLoading(show = true) {
            document.getElementById('loadingOverlay').classList.toggle('hidden', !show);
        }

        // // ========== DARK MODE TOGGLE ==========
        // const darkModeToggle = document.getElementById('darkModeToggle');
        // darkModeToggle.style.display = 'block';
        // function setDarkMode(enabled) {
        //     if (enabled) {
        //         document.documentElement.classList.add('dark');
        //         localStorage.setItem('darkMode', '1');
        //         darkModeToggle.innerHTML = '<i class="fas fa-sun"></i>';
        //     } else {
        //         document.documentElement.classList.remove('dark');
        //         localStorage.setItem('darkMode', '0');
        //         darkModeToggle.innerHTML = '<i class="fas fa-moon"></i>';
        //     }
        // }
        // darkModeToggle.addEventListener('click', () => {
        //     setDarkMode(!document.documentElement.classList.contains('dark'));
        // });
        // On load
        // if (localStorage.getItem('darkMode') === '1') setDarkMode(true);

        // ========== ACCESSIBILITY: Focus Styles & ARIA ==========
        document.querySelectorAll('button, [tabindex]').forEach(el => {
            el.addEventListener('focus', () => el.classList.add('ring', 'ring-orange-500'));
            el.addEventListener('blur', () => el.classList.remove('ring', 'ring-orange-500'));
        });

        // ========== CART PERSISTENCE ==========
        function loadCartFromStorage() {
            const saved = localStorage.getItem('cafCart');
            return saved ? JSON.parse(saved) : {};
        }

        function saveCartToStorage() {
            localStorage.setItem('cafCart', JSON.stringify(cart));
        }

        function clearCartStorage() {
            localStorage.removeItem('cafCart');
            cart = {};
            updateBottomBar();
            showToast('Cart cleared', 'success');
        }

        // ========== ORDER ORDER ==========
        function loadOrderHistory() {
            const history = localStorage.getItem('orderHistory');
            return history ? JSON.parse(history) : [];
        }

        function saveOrderToHistory(order) {
            const history = loadOrderHistory();
            history.unshift(order);
            localStorage.setItem('orderHistory', JSON.stringify(history.slice(0, 20)));
        }

        function renderOrderHistory() {
            const history = loadOrderHistory();
            const historyList = document.getElementById('history-list');
            
            if (history.length === 0) {
                historyList.innerHTML = '<p class="text-center text-gray-400 py-8">No order history yet</p>';
                return;
            }
            
            historyList.innerHTML = history.map(order => `
                <div class="history-item shadow-sm border border-gray-100">
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <p class="font-bold text-gray-800">${order.id}</p>
                            <p class="text-sm text-gray-600">Room: ${order.room} | ${order.name}</p>
                        </div>
                        <span class="history-item-amount">‚Çπ${order.total}</span>
                    </div>
                    <p class="text-sm text-gray-700 mb-2">${order.items}</p>
                    <p class="history-item-time">${order.date}</p>
                </div>
            `).join('');
        }

        function toggleHistory() {
            renderOrderHistory();
            document.getElementById('history-modal').classList.toggle('hidden');
        }

        function closeHistory() {
            document.getElementById('history-modal').classList.add('hidden');
        }

        // ========== FAVORITES SYSTEM ==========
        function toggleFavorite(itemId, itemName, itemPrice) {
            if (!favorites[itemId]) {
                favorites[itemId] = { id: itemId, name: itemName, price: itemPrice };
                showToast(`Added ${itemName} to favorites! ‚ù§Ô∏è`, 'success');
            } else {
                delete favorites[itemId];
                showToast(`Removed from favorites`, 'success');
            }
            localStorage.setItem('favorites', JSON.stringify(favorites));
            renderFavorites();
        }

        function renderFavorites() {
            const favoritesList = document.getElementById('favorites-list');
            const favItems = Object.values(favorites);
            
            if (favItems.length === 0) {
                favoritesList.innerHTML = '<p class="text-center text-gray-400 py-8">No favorites yet. Mark items with ‚ù§Ô∏è</p>';
                return;
            }
            
            favoritesList.innerHTML = favItems.map(item => `
                <div class="bg-gray-50 p-4 rounded-xl flex justify-between items-center border border-red-100">
                    <div class="flex-1">
                        <p class="font-bold text-gray-800">${item.name}</p>
                        <p class="text-red-600 font-semibold">‚Çπ${item.price.toFixed(2)}</p>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="addFavToCart(${item.id}, '${item.name}', ${item.price})" class="quick-add-btn">+ Add</button>
                        <button onclick="toggleFavorite(${item.id})" class="text-red-500 text-xl">‚úï</button>
                    </div>
                </div>
            `).join('');
        }

        function addFavToCart(id, name, price) {
            changeQty(id, 1, name, price);
            showToast(`${name} added to cart!`, 'success');
            closeFavorites();
        }

        function toggleFavorites() {
            document.getElementById('favorites-modal').classList.toggle('hidden');
        }

        function closeFavorites() {
            document.getElementById('favorites-modal').classList.add('hidden');
        }

        // ========== DYNAMIC ESTIMATED TIME ==========
        function calculateEstimatedTime() {
            let itemCount = 0;
            Object.values(cart).forEach(i => itemCount += i.qty);
            
            let baseTime = 15;
            let timePerItem = 2;
            let total = baseTime + (itemCount * timePerItem);
            total = Math.min(total, 45); // Cap at 45 mins
            
        return total;
        }

        function updateEstimatedTime() {
            const estimatedTime = calculateEstimatedTime();
            const timeElements = document.querySelectorAll('[data-est-time]');
            timeElements.forEach(el => {
                el.textContent = `${estimatedTime}-${estimatedTime + 5} mins`;
            });
        }

        // ========== VALIDATION FUNCTIONS ==========
        function validateName() {
            const nameInput = document.getElementById('cust-name');
            const nameError = document.getElementById('name-error');
            const name = nameInput.value.trim();

            if (name.length === 0) {
                nameInput.classList.add('input-error');
                nameError.innerText = 'Name is required';
                nameError.classList.remove('hidden');
                return false;
            } else if (name.length < 3) {
                nameInput.classList.add('input-error');
                nameError.innerText = 'Name must be at least 3 characters';
                nameError.classList.remove('hidden');
                return false;
            } else {
                nameInput.classList.remove('input-error');
                nameError.classList.add('hidden');
                return true;
            }
        }

        function validatePhone() {
            const phoneInput = document.getElementById('cust-phone');
            const phoneError = document.getElementById('phone-error');
            const phone = phoneInput.value.trim();
            const phoneRegex = /^[6-9]\d{9}$/;

            if (phone.length === 0) {
                phoneInput.classList.add('input-error');
                phoneError.innerText = 'Phone number is required';
                phoneError.classList.remove('hidden');
                return false;
            } else if (!phoneRegex.test(phone)) {
                phoneInput.classList.add('input-error');
                phoneError.innerText = 'Enter a valid 10-digit Indian mobile number';
                phoneError.classList.remove('hidden');
                return false;
            } else {
                phoneInput.classList.remove('input-error');
                phoneError.classList.add('hidden');
                return true;
            }
        }

        function validateForm() {
            return validateName() && validatePhone();
        }

        // ========== DIETARY FILTER ==========
        function toggleDietaryFilter(type) {
            currentDietaryFilter = type;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`filter-${type}`).classList.add('active');
            filterMenu();
        }

        function applyDietaryFilter(items) {
            if (currentDietaryFilter === 'all') return items;
            if (currentDietaryFilter === 'veg') return items.filter(i => i.isVeg);
            if (currentDietaryFilter === 'nonveg') return items.filter(i => !i.isVeg);
            return items;
        }

        function closeConfirmationAndRefresh() {
            document.getElementById('order-confirmation-modal').classList.add('hidden');
            location.reload();
        }


        async function loadMenu() {
    try {
        const res = await fetch('menu.json');
        menu = await res.json();

        const specialsRes = await fetch('config.json');
        banner = await specialsRes.json();
        
        // Render Specials
        renderSpecials(banner.specials);
        
        // Apply Config Settings
        const config = banner.config;
        document.getElementById('hours-display').innerText = config.serviceHours;
        document.getElementById('call-link').href = `tel:${config.frontDeskPhone}`;
        
        // Handle "Closed" State
        const orderBtn = document.getElementById('place-order-btn');
        if (!config.isOpen) {
            orderBtn.disabled = true;
            orderBtn.innerText = "Kitchen is Currently Closed";
            orderBtn.classList.replace('bg-green-600', 'bg-gray-400');
        }

        
        // Render menu menu (excluding config and specials)
        const menuItemsOnly = { ...menu };
        delete menuItemsOnly.specials;
        delete menuItemsOnly.config;
        
        renderMenu(menuItemsOnly);
        renderCategoryNav(menuItemsOnly);
    } catch (e) { console.error(e); }
}

function renderUpsellItems() {
    const container = document.getElementById('upsell-list');
    // This looks for the 'Upsell Items' key in your menu.json
    const upsells = banner['upSellItems'] || []; 
    
    if (upsells.length === 0) {
        document.getElementById('treat-yourself').classList.add('hidden');
        return;
    }

    document.getElementById('treat-yourself').classList.remove('hidden');
    
    container.innerHTML = upsells.map(item => `
        <div
             class="min-w-[130px] bg-white p-4 rounded-2xl text-center border-2 border-dashed border-orange-100 cursor-pointer active:scale-95 transition-transform shadow-sm">
            <p class="text-[11px] font-bold text-gray-700 mb-1">${item.name}</p>
            <p class="text-orange-600 font font text-xs">‚Çπ${item.price.toFixed(2)}</p>

            <div class="flex items-center gap-3 bg-gray-100 p-1.5 rounded-full">
                <button onclick="changeQty(${item.id}, -1, '${item.name}', ${item.price})" class="w-8 h-8 flex items-center justify-center bg-white rounded-full shadow-sm text-orange-900 font-bold">-</button>
                            <span id="qty-${item.id}" class="w-4 text-center font-bold text-sm">0</span>
                            <button onclick="changeQty(${item.id}, 1, '${item.name}', ${item.price})" class="w-8 h-8 flex items-center justify-center bg-orange-900 text-white rounded-full shadow-sm font-bold">+</button>
                </div>
        </div>
    `).join('');
}



function renderSpecials(specials) {
    const slider = document.getElementById('banner-slider');
    if (!specials || specials.length === 0) return;

    slider.innerHTML = specials.map(s => `
        <div class="min-w-full p-4 ${s.bgColor} ${s.textColor} rounded-2xl flex items-center gap-3 shadow-inner mr-4">
            <i class="fa fa-star animate-pulse"></i>
            <span class="font-bold text-sm overflow-hidden text-ellipsis">${s.text}</span>
        </div>
    `).join('');

    // Auto-slide logic
    let index = 0;
    if (specials.length > 1) {
        setInterval(() => {
            index = (index + 1) % specials.length;
            slider.style.transform = `translateX(-${index * 100}%)`;
        }, 4000);
    }
}


        function renderMenu(data) {
            const container = document.getElementById('menu-container');
            container.innerHTML = "";
            for (const [category, items] of Object.entries(data)) {
                const filteredItems = applyDietaryFilter(items);
                if(filteredItems.length === 0) continue;
                let section = `<h2 id="cat-${category.replace(/\s/g, '')}" class="category-pill text-xl font-bold mt-8 mb-4 text-gray-800 flex items-center gap-2">
                    <span class="w-1 h-6 bg-orange-600 rounded-full"></span> ${category}</h1>`;
                
                filteredItems.forEach(item => {
                    const tag = item.isVeg ? 
    '<div class="veg-box"><div class="veg-dot"></div></div>' : 
    '<div class="nonveg-box"><div class="nonveg-dot"></div></div>';

                    const trending = item.isTrending ? '<span class="ml-2 bg-red-100 text-red-600 text-[8px] px-1.5 py-0.5 rounded-full font-bold uppercase"><i class="fa fa-fire mr-1"></i>Trending</span>' : '';
                    const isFav = favorites[item.id] ? 'active' : '';

                    section += `
                    <div class="flex justify-between items-center bg-white p-4 rounded-2xl mb-3 shadow-sm border border-gray-50 relative">
                        <i class="fa fa-heart fav-star ${isFav}" onclick="toggleFavorite(${item.id}, '${item.name}', ${item.price})" style="position: absolute; top: 8px; right: 8px; color: ${isFav ? '#f97316' : '#ccc'};"></i>
                        <div class="flex-1 pr-4">
                            <h3 class="font-bold text-gray-800">${tag}${item.name}</h3>
                            <p class="text-orange-700 font-semibold">‚Çπ${item.price.toFixed(2)}</p>
                        </div>
                        <div class="flex items-center gap-3 bg-gray-100 p-1.5 rounded-full">
                            <button onclick="changeQty(${item.id}, -1, '${item.name}', ${item.price})" class="w-8 h-8 flex items-center justify-center bg-white rounded-full shadow-sm text-orange-900 font-bold">-</button>
                            <span id="qty-${item.id}" class="w-4 text-center font-bold text-sm">0</span>
                            <button onclick="changeQty(${item.id}, 1, '${item.name}', ${item.price})" class="w-8 h-8 flex items-center justify-center bg-orange-900 text-white rounded-full shadow-sm font-bold">+</button>
                        </div>
                    </div>`;
                });
                container.innerHTML += section;
            }
        }

        function renderCategoryNav() {
            const list = document.getElementById('category-list');
            list.innerHTML = "";
            Object.keys(menu).forEach(cat => {
                list.innerHTML += `<button onclick="scrollToCat('cat-${cat.replace(/\s/g, '')}')" class="block w-full text-left font-medium text-gray-600 hover:text-orange-700 py-1 capitalize">${cat}</button>`;
            });
        }

        function filterMenu() {
            const query = document.getElementById('search-input').value.toLowerCase();
            const filtered = {};
            for (const [category, items] of Object.entries(menu)) {
                const matches = items.filter(i => i.name.toLowerCase().includes(query));
                if (matches.length > 0) filtered[category] = matches;
            }
            renderMenu(filtered);
        }

        function updateUpsellProgress(total) {
    const goal = 500; // Set your target amount for freebie/discount
    const perc = Math.min((total / goal) * 100, 100);
    document.getElementById('upsell-progress-container').classList.toggle('hidden', total === 0);
    document.getElementById('upsell-bar').style.width = perc + "%";
    document.getElementById('upsell-percent').innerText = Math.round(perc) + "%";
    document.getElementById('upsell-msg').innerText = total < goal ? 
        `Add ‚Çπ${(goal - total).toFixed(0)} more for a free dessert!` : "You've earned a free dessert! üéÅ";
}


        function scrollToCat(id) {
            const el = document.getElementById(id);
            if (el) {
                const header = document.querySelector('header');
                const headerHeight = header ? header.offsetHeight : 0;
                const y = el.getBoundingClientRect().top + window.pageYOffset - headerHeight - 8; // 8px extra margin
                window.scrollTo({ top: y, behavior: 'smooth' });
                toggleNav();
            }
        }

        function toggleNav() { document.getElementById('nav-menu').classList.toggle('hidden'); }

        function changeQty(id, delta, name, price) {
            if (!cart[id]) cart[id] = { name: name, price: price, qty: 0 };
            cart[id].qty += delta;
            if (cart[id].qty <= 0) delete cart[id];
            
            document.querySelectorAll(`#qty-${id}`).forEach(el => el.innerText = cart[id] ? cart[id].qty : 0);
            updateBottomBar();
            renderCartItems();
            saveCartToStorage();
            showToast(`${name} ${delta > 0 ? 'added' : 'removed'}`, 'success');
            updateEstimatedTime();
        }

        function updateBottomBar() {
            let count = 0, total = 0;
            Object.values(cart).forEach(i => { count += i.qty; total += (i.qty * i.price); });
            const bar = document.getElementById('bottom-bar');
            bar.classList.toggle('hidden', count === 0);
            document.getElementById('cart-count').innerText = count + " Items Selected";
            document.getElementById('cart-total').innerText = "‚Çπ" + total.toFixed(2);
            document.getElementById('cart-count-bottom').innerText = count + " Items Selected";
            document.getElementById('cart-total-bottom').innerText = "‚Çπ" + total.toFixed(2);
            updateUpsellProgress(total);
        }

        function toggleCart() { document.getElementById('cart-modal').classList.toggle('hidden'); renderCartItems();renderUpsellItems(); }

        function renderCartItems() {
            const list = document.getElementById('cart-items');
            list.innerHTML = Object.values(cart).map(i => `
                <div class="flex justify-between items-center bg-gray-50 p-3 rounded-xl">
                    <span class="font-medium">${i.qty}x ${i.name}</span>
                    <span class="font-bold text-orange-900">‚Çπ${(i.qty * i.price).toFixed(2)}</span>
                </div>
            `).join('') || "<p class='text-center text-gray-400'>Your cart is empty</p>";
        }

        // 1. Guest Memory: Load saved details when the page opens
window.onload = function() {
    document.getElementById('cust-name').value = localStorage.getItem('guestName') || "";
    document.getElementById('cust-phone').value = localStorage.getItem('guestPhone') || "";
    cart = loadCartFromStorage();
    
    // Render cart if it exists
    if (Object.keys(cart).length > 0) {
        Object.entries(cart).forEach(([id, item]) => {
            document.querySelectorAll(`#qty-${id}`).forEach(el => el.innerText = item.qty);
        });
        updateBottomBar();
        showToast('Cart restored! üõí', 'success');
    }
    
    loadMenu();
};

async function sendOrder() {
    if (!validateForm()) return;
    let itemCount = 0, total = 0;
    Object.values(cart).forEach(i => { itemCount += i.qty; total += (i.qty * i.price); });
    if (itemCount === 0) return alert("Please add items to your cart");
    const name = document.getElementById('cust-name').value;
    const phone = document.getElementById('cust-phone').value;
    const notes = document.getElementById('special-notes').value || "None";
    const schedule = document.getElementById('delivery-schedule').value;
    const payment = document.querySelector('input[name="payment"]:checked').value;
    localStorage.setItem('guestName', name);
    localStorage.setItem('guestPhone', phone);
    let text = `üõé *NEW ORDER: ROOM ${roomNumber}*\n`;
    text += `üë§ *Guest:* ${name}\n`;
    text += `üìû *Phone:* ${phone}\n`;
    text += `‚è∞ *Delivery:* ${schedule}\n`;
    text += `üí≥ *Payment:* ${payment}\n`;
    text += `üìù *Notes:* ${notes}\n\n`;
    let itemsText = "";
    Object.values(cart).forEach(i => {
        text += `‚Ä¢ ${i.qty}x ${i.name} (‚Çπ${(i.qty * i.price).toFixed(2)})\n`;
        itemsText += `${i.qty}x ${i.name}, `;
    });
    text += `\nüí∞ *Total: ‚Çπ${total.toFixed(2)}*`;
    itemsText = itemsText.slice(0, -2);
    const btn = document.getElementById('place-order-btn');
    btn.innerText = "Confirming...";
    btn.disabled = true;
    try {
        // POST to Google Apps Script
        let orderId = await postOrderToSheet({
            room: roomNumber,
            name: name,
            phone: phone,
            items: itemsText,
            total: total.toFixed(2)
        });
        // ...existing Telegram logic...
        await fetch(SCRIPT_URL, { method: "POST", mode: 'no-cors', body: JSON.stringify({ text: text }) });
        // ...existing confirmation modal logic...
        const estimatedTime = calculateEstimatedTime();
        orderId = orderId || ('ORD-' + Date.now().toString().slice(-6));
        document.getElementById('order-id-display').innerText = orderId;
        document.getElementById('confirm-room').innerText = roomNumber;
        document.getElementById('confirm-name').innerText = name;
        document.getElementById('confirm-items').innerText = itemsText;
        document.getElementById('confirm-total').innerText = "‚Çπ" + total.toFixed(2);
        document.querySelector('[data-est-time]').innerText = `${estimatedTime}-${estimatedTime + 5} mins`;
        const order = { id: orderId, room: roomNumber, name: name, date: new Date().toLocaleString(), items: itemsText, total: total.toFixed(2) };
        saveOrderToHistory(order);
        clearCartStorage();
        document.getElementById('cart-modal').classList.add('hidden');
        document.getElementById('order-confirmation-modal').classList.remove('hidden');
        cart = {};
        updateBottomBar();
        showToast('Order placed successfully! üéâ', 'success');
    } catch (e) {
        alert("Error placing order. Please try again.");
        btn.disabled = false;
        btn.innerText = "Place Order";
    }
}

// Google Apps Script endpoint
// const APPS_SCRIPT_URL = 'YOUR_APPS_SCRIPT_DEPLOYED_URL'; // <-- Replace with your deployed Apps Script Web App URL

// --- Order POST to Google Apps Script ---
async function postOrderToSheet(orderData) {
    try {
        const res = await fetch(ORDER_SCRIPT_URL, {
            method: 'POST',
            mode: 'no-cors',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(orderData)
        });
        const result = await res.json();
        return result.orderId;
    } catch (e) {
        showToast('Order not saved to admin sheet!', 'error');
        return null;
    }
}

// --- Track Order Modal Logic ---
function toggleTrackOrder() {
    document.getElementById('track-order-modal').classList.toggle('hidden');
    document.getElementById('track-order-result').innerHTML = '';
    document.getElementById('track-order-id').value = '';
}
function closeTrackOrder() {
    document.getElementById('track-order-modal').classList.add('hidden');
}

async function trackOrderStatus() {
    const orderId = document.getElementById('track-order-id').value.trim();
    if (!orderId) {
        document.getElementById('track-order-result').innerHTML = '<p class="text-red-500">Please enter your Order ID.</p>';
        return;
    }
    document.getElementById('track-order-result').innerHTML = '<p class="text-gray-500">Checking...</p>';
    try {
        const res = await fetch(`${ORDER_SCRIPT_URL}?orderId=${encodeURIComponent(orderId)}`, { mode: 'no-cors' });
        const data = await res.json();
        if (data.error) {
            document.getElementById('track-order-result').innerHTML = `<p class='text-red-500'>${data.error}</p>`;
        } else {
            document.getElementById('track-order-result').innerHTML = `
                <div class='bg-blue-50 p-4 rounded-xl'>
                    <p class='font-bold text-blue-900 mb-2'>Order ID: ${data.orderId}</p>
                    <p class='text-sm'><span class='font-bold'>Status:</span> <span class='text-blue-700'>${data.status}</span></p>
                    <p class='text-sm'><span class='font-bold'>Items:</span> ${data.items}</p>
                    <p class='text-sm'><span class='font-bold'>Total:</span> ‚Çπ${data.total}</p>
                </div>
            `;
        }
    } catch (e) {
        document.getElementById('track-order-result').innerHTML = '<p class="text-red-500">Could not fetch order status.</p>';
    }
}
        loadMenu();
    </script>
    <!-- <section class="p-4 max-w-md mx-auto mt-10 mb-20 border-t border-gray-200">
    <h2 class="text-lg font-bold text-gray-800 mb-4">üè® Guest Concierge</h2>
    <div class="grid grid-cols-2 gap-3">
        <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100">
            <i class="fa fa-wifi text-orange-600 mb-2"></i>
            <p class="text-[10px] text-gray-400 uppercase font-bold">Wi-Fi Password</p>
            <p class="text-sm font-bold text-gray-700">HotelGuest2024</p>
        </div>
        <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100">
            <i class="fa fa-clock text-orange-600 mb-2"></i>
            <p class="text-[10px] text-gray-400 uppercase font-bold">Checkout Time</p>
            <p class="text-sm font-bold text-gray-700">11:00 AM</p>
        </div>
        <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100 col-span-2 flex justify-between items-center">
            <div>
                <p class="text-[10px] text-gray-400 uppercase font-bold">Need a Taxi?</p>
                <p class="text-sm font-bold text-gray-700">Reception can book one for you</p>
            </div>
            <a href="tel:+1234567" class="bg-orange-100 p-3 rounded-full text-orange-600"><i class="fa fa-taxi"></i></a>
        </div>
    </div>
</section> -->

</body>
</html>
