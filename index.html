<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OMISHA CAFE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .category-pill { scroll-margin-top: 100px; }
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 10px; }
    </style>
</head>
<body class="bg-gray-50 pb-32">

    <header class="bg-orange-900 text-white p-4 shadow-lg sticky top-0 z-50">
        <div class="flex justify-between items-center mb-3">
            <h1 class="text-xl font-bold">OMISHA CAFE</h1>
            <span id="room-display" class="text-xs bg-orange-800 px-3 py-1 rounded-full border border-orange-700">Room: ...</span>
        </div>
        
        <div class="relative">
            <i class="fa fa-search absolute left-3 top-3 text-gray-400"></i>
            <input type="text" id="search-input" oninput="filterMenu()" placeholder="Search coffee, snacks..." 
                class="w-full p-2 pl-10 rounded-xl text-gray-800 focus:outline-none focus:ring-2 focus:ring-orange-500">
        </div>

        <div id="status-notice" class="mt-2 text-[10px] text-center py-1 rounded-md font-bold uppercase tracking-widest bg-orange-800/50 text-orange-200">
    Service Hours: <span id="hours-display">Loading...</span>
</div>

    </header>

    <div id="special-banner-container" class="px-4 mt-4 overflow-hidden whitespace-nowrap">
    <div id="banner-slider" class="flex transition-transform duration-500 ease-in-out">
        </div>
    </div>

    <main class="p-4 max-w-md mx-auto" id="menu-container">
        <div class="text-center py-20 text-gray-400">Loading Menu...</div>
    </main>

    <div id="nav-btn" onclick="toggleNav()" class="fixed bottom-24 right-4 bg-white text-orange-900 w-12 h-12 rounded-full shadow-2xl flex items-center justify-center border border-orange-100 z-[55] cursor-pointer">
        <i class="fa fa-utensils"></i>
    </div>

    <div id="nav-menu" class="fixed inset-0 bg-black/40 z-[60] hidden" onclick="toggleNav()">
        <div class="absolute bottom-40 right-4 bg-white rounded-2xl p-4 shadow-2xl min-w-[200px]" onclick="event.stopPropagation()">
            <h3 class="text-xs font-bold text-gray-400 mb-3 uppercase tracking-widest">Categories</h3>
            <div id="category-list" class="space-y-3"></div>
        </div>
    </div>

    <a id="call-link" href="tel:+1234567890" class="fixed bottom-24 left-4 bg-green-600 text-white w-12 h-12 rounded-full shadow-2xl flex items-center justify-center z-[55] cursor-pointer">
    <i class="fa fa-phone"></i>
</a>


    <div id="bottom-bar" class="fixed bottom-0 left-0 right-0 bg-white border-t p-4 flex justify-between items-center hidden shadow-[0_-10px_20px_rgba(0,0,0,0.05)] z-50">
        <div onclick="toggleCart()" class="cursor-pointer">
            <p id="cart-count" class="text-orange-900 font-bold text-sm">0 Items</p>
            <p id="cart-total" class="text-xl font-black text-gray-900">â‚¹0.00</p>
        </div>
        <button onclick="toggleCart()" class="bg-orange-900 text-white px-8 py-3 rounded-2xl font-bold shadow-lg shadow-orange-900/20">View Cart</button>
    </div>

    <div id="cart-modal" class="fixed inset-0 bg-black/60 z-[70] hidden flex items-end">
        <div class="bg-white w-full rounded-t-[2.5rem] p-8 max-h-[85vh] overflow-y-auto shadow-2xl">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">Your Order</h2>
                <button onclick="toggleCart()" class="text-gray-300 text-3xl">&times;</button>
            </div>
            <div id="cart-items" class="space-y-4 mb-8"></div>
            <div class="space-y-4 border-t pt-6">
                <input type="text" id="cust-name" placeholder="Full Name" class="w-full p-4 bg-gray-50 border-none rounded-2xl focus:ring-2 focus:ring-orange-500">
                <input type="tel" id="cust-phone" placeholder="Mobile Number" class="w-full p-4 bg-gray-50 border-none rounded-2xl focus:ring-2 focus:ring-orange-500">
                <button onclick="sendOrder()" id="place-order-btn" class="w-full bg-green-600 text-white py-5 rounded-2xl font-bold text-lg shadow-xl shadow-green-600/20">Place Your Order</button>
            </div>
        </div>
    </div>

    <script>
        let menu = {};
        let cart = {};
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbx_YgOYiEthHx5Y4FVDbK5C_xEXe0mum_stCQ-T143tfhaLUwjJJ9U2gOdB3OpLsXva/exec"; // Update this
        
        const params = new URLSearchParams(window.location.search);
        const roomNumber = params.get('room') || "Lobby";
        document.getElementById('room-display').innerText = "Room: " + roomNumber;


        async function loadMenu() {
    try {
        const res = await fetch('menu.json');
        menu = await res.json();

        const specialsRes = await fetch('config.json');
        banner = await specialsRes.json();
        
        // Render Specials
        renderSpecials(banner.specials);
        
        // Apply Config Settings
        const config = banner.config;
        document.getElementById('hours-display').innerText = config.serviceHours;
        document.getElementById('call-link').href = `tel:${config.frontDeskPhone}`;
        
        // Handle "Closed" State
        const orderBtn = document.getElementById('place-order-btn');
        if (!config.isOpen) {
            orderBtn.disabled = true;
            orderBtn.innerText = "Kitchen is Currently Closed";
            orderBtn.classList.replace('bg-green-600', 'bg-gray-400');
        }

        
        // Render menu items (excluding config and specials)
        const menuItemsOnly = { ...menu };
        delete menuItemsOnly.specials;
        delete menuItemsOnly.config;
        
        renderMenu(menuItemsOnly);
        renderCategoryNav(menuItemsOnly);
    } catch (e) { console.error(e); }
}


function renderSpecials(specials) {
    const slider = document.getElementById('banner-slider');
    if (!specials || specials.length === 0) return;

    slider.innerHTML = specials.map(s => `
        <div class="min-w-full p-4 ${s.bgColor} ${s.textColor} rounded-2xl flex items-center gap-3 shadow-inner mr-4">
            <i class="fa fa-star animate-pulse"></i>
            <span class="font-bold text-sm overflow-hidden text-ellipsis">${s.text}</span>
        </div>
    `).join('');

    // Auto-slide logic
    let index = 0;
    if (specials.length > 1) {
        setInterval(() => {
            index = (index + 1) % specials.length;
            slider.style.transform = `translateX(-${index * 100}%)`;
        }, 4000);
    }
}


        function renderMenu(data) {
            const container = document.getElementById('menu-container');
            container.innerHTML = "";
            for (const [category, items] of Object.entries(data)) {
                if(items.length === 0) continue;
                let section = `<h2 id="cat-${category.replace(/\s/g, '')}" class="category-pill text-xl font-bold mt-8 mb-4 text-gray-800 flex items-center gap-2">
                    <span class="w-1 h-6 bg-orange-600 rounded-full"></span> ${category}</h2>`;
                items.forEach(item => {
                    section += `
                    <div class="flex justify-between items-center bg-white p-4 rounded-2xl mb-3 shadow-sm border border-gray-50">
                        <div class="flex-1">
                            <h3 class="font-bold text-gray-800">${item.name}</h3>
                            <p class="text-orange-700 font-semibold">â‚¹${item.price.toFixed(2)}</p>
                        </div>
                        <div class="flex items-center gap-3 bg-gray-100 p-1.5 rounded-full">
                            <button onclick="changeQty(${item.id}, -1, '${item.name}', ${item.price})" class="w-8 h-8 flex items-center justify-center bg-white rounded-full shadow-sm text-orange-900 font-bold">-</button>
                            <span id="qty-${item.id}" class="w-4 text-center font-bold text-sm">0</span>
                            <button onclick="changeQty(${item.id}, 1, '${item.name}', ${item.price})" class="w-8 h-8 flex items-center justify-center bg-orange-900 text-white rounded-full shadow-sm font-bold">+</button>
                        </div>
                    </div>`;
                });
                container.innerHTML += section;
            }
        }

        function renderCategoryNav() {
            const list = document.getElementById('category-list');
            list.innerHTML = "";
            Object.keys(menu).forEach(cat => {
                list.innerHTML += `<button onclick="scrollToCat('cat-${cat.replace(/\s/g, '')}')" class="block w-full text-left font-medium text-gray-600 hover:text-orange-700 py-1 capitalize">${cat}</button>`;
            });
        }

        function filterMenu() {
            const query = document.getElementById('search-input').value.toLowerCase();
            const filtered = {};
            for (const [category, items] of Object.entries(menu)) {
                const matches = items.filter(i => i.name.toLowerCase().includes(query));
                if (matches.length > 0) filtered[category] = matches;
            }
            renderMenu(filtered);
        }

        function scrollToCat(id) {
            document.getElementById(id).scrollIntoView({ behavior: 'smooth' });
            toggleNav();
        }

        function toggleNav() { document.getElementById('nav-menu').classList.toggle('hidden'); }

        function changeQty(id, delta, name, price) {
            if (!cart[id]) cart[id] = { name: name, price: price, qty: 0 };
            cart[id].qty += delta;
            if (cart[id].qty <= 0) delete cart[id];
            
            document.querySelectorAll(`#qty-${id}`).forEach(el => el.innerText = cart[id] ? cart[id].qty : 0);
            updateBottomBar();
        }

        function updateBottomBar() {
            let count = 0, total = 0;
            Object.values(cart).forEach(i => { count += i.qty; total += (i.qty * i.price); });
            const bar = document.getElementById('bottom-bar');
            bar.classList.toggle('hidden', count === 0);
            document.getElementById('cart-count').innerText = count + " Items Selected";
            document.getElementById('cart-total').innerText = "â‚¹" + total.toFixed(2);
        }

        function toggleCart() { document.getElementById('cart-modal').classList.toggle('hidden'); renderCartItems(); }

        function renderCartItems() {
            const list = document.getElementById('cart-items');
            list.innerHTML = Object.values(cart).map(i => `
                <div class="flex justify-between items-center bg-gray-50 p-3 rounded-xl">
                    <span class="font-medium">${i.qty}x ${i.name}</span>
                    <span class="font-bold text-orange-900">â‚¹${(i.qty * i.price).toFixed(2)}</span>
                </div>
            `).join('') || "<p class='text-center text-gray-400'>Your cart is empty</p>";
        }

        async function sendOrder() {
            const name = document.getElementById('cust-name').value;
            const phone = document.getElementById('cust-phone').value;
            if (!name || !phone) return alert("Please provide details");

            let text = `ðŸ›Ž *ORDER: ROOM ${roomNumber}*\nðŸ‘¤ *Name:* ${name}\nðŸ“ž *Phone:* ${phone}\n\n`;
            let total = 0;
            Object.values(cart).forEach(i => {
                text += `â€¢ ${i.qty}x ${i.name} (â‚¹${(i.qty * i.price).toFixed(2)})\n`;
                total += (i.qty * i.price);
            });
            text += `\nðŸ’° *Total: â‚¹${total.toFixed(2)}*`;

            const btn = document.getElementById('place-order-btn');
            btn.innerText = "Processing...";
            btn.disabled = true;

            try {
                await fetch(SCRIPT_URL, { method: "POST", mode: 'no-cors', body: JSON.stringify({ text: text }) });
                alert("Order Placed Successfully!");
                location.reload();
            } catch (e) { alert("Error sending order."); btn.disabled = false; }
        }

        loadMenu();
    </script>
</body>
</html>

